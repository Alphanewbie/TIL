# 엘라스틱 서치 소개

루샨을 베이스로 하는 검색 엔진

### 기본 컨셉트

- 검색 엔진. 
  - 본격적인 전문 검색이 가능하며, 
  - 역색인을 사용하여 검색 속도 빠르다.
- 분산 처리, 
  - 분산 처리를 고려하여 설계됬다. 
  - 데이터를 여러 노드에 분석 저장하며 검색이나 집계 작업들을 수행할 때도 분신 처리를 지원
- 고가용성 제공,
  - 일부 노드에 장애가 발생해도 복제본 데이터를 사용해 중단 없이 서비스 지속, 이때 다시 복제본을 만들어 에러가 발생해도 복제본의 균형을 자동으로 맞춘다.
- 수평적 확장성
  - 더 많은 처리가 요구되는 때를 위해 수평적 확장 지원
  - 새로운 노드에 엘라스틱 서치를 설치하여 클러스터에 참여 시키는 걸로 간단하게 확장
  - 새 노드에 데이터를 복제도 자동 수행
- JSON 기반의 REST API 제공
  - 엘라스틱 서치는 JSON 형태의 문서를 저장, 색인 검색
  - 환경에 구애 받지 않고 HTTP를 이용해 쉽게 이용 가능
- 데이터 안정성
  - 데이터 색인 요청후 200 을 받았다면 그 데이터는 확실히 디스크에 저장
- 준 실시간 검색
  - 데이터를 색인하자마자 조회하는건 가능하지만, 색인 후 검색 요청은 성공하지 못할 가능성이 높다. -> 역색인으로부터 검색이 가능해지기 까지 시간이 걸리기 때문
- 트랜잭션이 지원되지 않음.
  - RDBMS와는 다르게 트랜잭션을 지원하지 않는다.
- 사실상 조인을 지원하지 않음
  - join을 염두에 두고 설계되지 않음.
  - 아주 제한적으로 상요된다고 생각해야한다.



# 엘라스틱 서치 기본 동작과 구조

## 엘라스틱 서치 기본 동작

### 문서 색인

- `_id`를 지정하여 색인

문서를 색인한 인덱스 이름, _id값을 지정하고 PUT을 이용해 호출

```
PUT [인덱스 이름]/_doc/[_id값]
{
	{문서 내용}
}
```

- _id값을 지정하지 않고 색인

_id값을 지정하지 않으면 자동으로 _id값을 생성해준다. POST을 이용해 호출

```
POST [인덱스 이름]/_doc
{
	{문서 내용}
}
```

### 문서 조회

문서를 조회할 때는 인덱스 이름과 _id값을 지정하여 GET 메소드로 호출

```
GET [인덱스 이름]/_doc/[_id]
```



### 문서 업데이트

문서를 업데이트 할 는 이름과 _id값을 지정한다.

_doc 대신 `_update`를 사용

```
POST [인덱스 이름]/_update/[_id값]
{
	"doc": {
		[문서 내용]
	}
}
```



특정 부분만 업데이트 하는 방법

```
POST [인덱스 이름]/_update/[_id값]
{
	"doc": {
		"title": "Test Title"
	}
}
```



### 문서 검색

문서 검색 쿼리를 위한 전횽 DSL 쿼리를 제공한다.

인덱스 이름을 지정하고 그 뒤에 _search를 붙혀 검색

- 검색 메소드는 GET과 POST를 둘다 동일하게 지원한다. 하지만 보편적으로 GET쪽을 더 많이 쓴다.



가장 기본적인 match 쿼리를 사용한 요청

```
GET my index/_search
{
	"query" : {
		"match" : {
			"title": "hello world"
		}
	}
}
```

이렇게 검색을 하게 되면 `hello world` 와 `hello elastic search`또한 검색 되지만 `_search`의 일치도가 좀 낮게 나온다.